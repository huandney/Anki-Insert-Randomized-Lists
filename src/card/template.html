<script data-name="Randomized Lists" data-version="v2.0.0">
// https://github.com/huandney/Anki-Insert-Randomized-Lists
    
function reorderList(ul, indices) {
    indices.forEach(index => ul.appendChild(ul.children[index]));
}

function shuffleArray(array) {
    for (var i = array.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

function run() {
    var ulElements = document.querySelectorAll('ul.shuffle');
    var isBack = !!document.getElementById('back');
    var allIndices = isBack ? JSON.parse(sessionStorage.getItem('allIndices')) : {};

    ulElements.forEach((ul, i) => {
        var indices = allIndices[i] || shuffleArray(Array.from({length: ul.children.length}, (_, idx) => idx));
        if (!isBack) allIndices[i] = indices;
        reorderList(ul, indices);
    });

    if (!isBack) sessionStorage.setItem('allIndices', JSON.stringify(allIndices));
}

run();
</script>
